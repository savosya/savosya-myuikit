{"version":3,"file":"Component.stories-01cf5af9.js","sources":["../../packages/dropzone/src/components/overlay/index.tsx","../../packages/dropzone/src/dropzone.utils.ts","../../packages/dropzone/src/Component.tsx"],"sourcesContent":["import React, { FC } from 'react'\nimport clsx from 'clsx'\n\nimport cls from './index.module.scss'\n\nexport type OverlayProps = {\n  text?: string\n  visible?: boolean\n}\n\nexport const Overlay: FC<OverlayProps> = ({ text = 'Перетащите файлы', visible = false }) => (\n  <div\n    className={clsx(cls.overlay, {\n      [cls.visible]: visible\n    })}\n  >\n    <span className={cls.text}>{text}</span>\n  </div>\n)\n","import React from 'react'\n\nexport const preventAndStopEvent = (event: React.SyntheticEvent) => {\n  event.preventDefault()\n  event.stopPropagation()\n}\n","import * as React from 'react'\nimport { useCallback, useRef, useState } from 'react'\n\nimport clsx from 'clsx'\n\nimport { Overlay as DefaultOverlay } from './components'\nimport { DropzoneProps } from './dropzone.types'\nimport { preventAndStopEvent } from './dropzone.utils'\nimport cls from './index.module.scss'\n\nexport const Dropzone = ({\n  className,\n  children,\n  text = 'Перетащите файлы',\n  error = false,\n  overlay: Overlay = DefaultOverlay,\n  onDragEnter,\n  onDragLeave,\n  onDragOver,\n  onDrop,\n  block = false,\n  disabled\n}: DropzoneProps) => {\n  const [dragOver, setDragOver] = useState(false)\n\n  /**\n   * При ховере дочерних элементов срабатывает dragLeave, из-за чего пропадает оверлей\n   * https://stackoverflow.com/a/21002544\n   */\n  const dragCounter = useRef(0)\n\n  const handleDragOver = useCallback(\n    (event: React.DragEvent<HTMLElement>) => {\n      preventAndStopEvent(event)\n\n      if (disabled) return\n\n      if (onDragOver) {\n        onDragOver(event)\n      }\n    },\n    [onDragOver, disabled]\n  )\n\n  const handleDragEnter = useCallback(\n    (event: React.DragEvent<HTMLElement>) => {\n      preventAndStopEvent(event)\n\n      if (disabled) return\n\n      dragCounter.current += 1\n\n      setDragOver(true)\n\n      if (onDragEnter) {\n        onDragEnter(event)\n      }\n    },\n    [disabled, onDragEnter]\n  )\n\n  const handleDragLeave = useCallback(\n    (event: React.DragEvent<HTMLElement>) => {\n      preventAndStopEvent(event)\n\n      if (disabled) return\n\n      dragCounter.current -= 1\n\n      if (dragCounter.current > 0) return\n\n      setDragOver(false)\n\n      if (onDragLeave) {\n        onDragLeave(event)\n      }\n    },\n    [disabled, onDragLeave]\n  )\n\n  const handleDrop = useCallback(\n    (event: React.DragEvent<HTMLElement>) => {\n      preventAndStopEvent(event)\n\n      if (disabled) return\n\n      setDragOver(false)\n      dragCounter.current = 0\n\n      if (event.dataTransfer.files && event.dataTransfer.files.length > 0) {\n        if (onDrop) {\n          onDrop(event.dataTransfer.files)\n        }\n\n        event.dataTransfer.clearData()\n      }\n    },\n    [disabled, onDrop]\n  )\n\n  return (\n    <div\n      className={clsx(cls.root, className, {\n        [cls.dragOver]: dragOver,\n        [cls.error]: error,\n        [cls.block]: block,\n        [cls.disabled]: disabled\n      })}\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n      onDragOver={handleDragOver}\n      onDrop={handleDrop}\n    >\n      {children}\n      {Overlay && <Overlay text={text} visible={Boolean(dragOver)} />}\n    </div>\n  )\n}\n"],"names":["Overlay","text","visible","jsx","clsx","cls","preventAndStopEvent","event","Dropzone","className","children","error","DefaultOverlay","onDragEnter","onDragLeave","onDragOver","onDrop","block","disabled","dragOver","setDragOver","useState","dragCounter","useRef","handleDragOver","useCallback","handleDragEnter","handleDragLeave","handleDrop","jsxs"],"mappings":"yOAUOA,EAAA,CAAA,CAAA,KAAAC,EAAA,mBAAA,QAAAC,EAAA,EAAA,IAAAC,EACL,MAAC,CAAA,UAAAC,EAAAC,EAAA,QAAA,CAC8B,CAAAA,EAAA,OAAA,EAAAH,CACZ,CAAA,EAChB,SAAAC,EAAA,OAAA,CAAA,UAAAE,EAAA,KAAA,SAAAJ,EAAA,CAEgC,CACnC,qTCfW,MAAAK,EAAuBC,GAAgC,CAClEA,EAAM,eAAe,EACrBA,EAAM,gBAAgB,CACxB,2JCKOC,EAAA,CAAA,CAAkB,UAAAC,EACvB,SAAAC,EACA,KAAAT,EAAA,mBACO,MAAAU,EAAA,GACC,QAAAX,EAAAY,EACW,YAAAC,EACnB,YAAAC,EACA,WAAAC,EACA,OAAAC,EACA,MAAAC,EAAA,GACQ,SAAAC,CAEV,IAAA,CACE,KAAA,CAAAC,EAAAC,CAAA,EAAAC,EAAA,SAAA,EAAA,EAMAC,EAAAC,SAAA,CAAA,EAEAC,EAAAC,EAAA,YAAuBlB,GAAA,CAEnBD,EAAAC,CAAA,EAEA,CAAAW,GAEAH,GACEA,EAAAR,CAAA,CACF,EACF,CAAAQ,EAAAG,CAAA,CACqB,EAGvBQ,EAAAD,EAAA,YAAwBlB,GAAA,CAEpBD,EAAAC,CAAA,EAEA,CAAAW,IAEAI,EAAA,SAAA,EAEAF,EAAA,EAAA,EAEAP,GACEA,EAAAN,CAAA,EACF,EACF,CAAAW,EAAAL,CAAA,CACsB,EAGxBc,EAAAF,EAAA,YAAwBlB,GAAA,CAEpBD,EAAAC,CAAA,EAEA,CAAAW,IAEAI,EAAA,SAAA,EAEA,EAAAA,EAAA,QAAA,KAEAF,EAAA,EAAA,EAEAN,GACEA,EAAAP,CAAA,GACF,EACF,CAAAW,EAAAJ,CAAA,CACsB,EAGxBc,EAAAH,EAAA,YAAmBlB,GAAA,CAEfD,EAAAC,CAAA,EAEA,CAAAW,IAEAE,EAAA,EAAA,EACAE,EAAA,QAAA,EAEAf,EAAA,aAAA,OAAAA,EAAA,aAAA,MAAA,OAAA,IACES,GACEA,EAAAT,EAAA,aAAA,KAAA,EAGFA,EAAA,aAAA,aACF,EACF,CAAAW,EAAAF,CAAA,CACiB,EAGnB,OAAAa,EACE,MAAC,CAAA,UAAAzB,EAAAC,EAAA,KAAAI,EAAA,CACsC,CAAAJ,EAAA,QAAA,EAAAc,EACnB,CAAAd,EAAA,KAAA,EAAAM,EACH,CAAAN,EAAA,KAAA,EAAAY,EACA,CAAAZ,EAAA,QAAA,EAAAa,CACG,CAAA,EACjB,YAAAQ,EACY,YAAAC,EACA,WAAAH,EACD,OAAAI,EACJ,SAAA,CAEPlB,EAAAV,GAAAG,EAAAH,EAAA,CAAA,KAAAC,EAAA,QAAA,EAAAkB,EAAA,CAC4D,CAAA,CAAA,CAGnE;;;;;;;;;;;;;;;"}